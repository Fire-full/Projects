class "Все по работе со строкой";
Import Classes API ;

InClass Public
--------------------------------------------------------------------------------
--Заменяем столько, сколько есть!
функ ВСтрокеЗаменять(Что:Строка; НаЧто:Строка; Где:Строка): Строка;
 var Стр,Стр2,Тмп,Отсюда,ИскатьЗдесь : Строка;
 var Рез, ПозПовтора, ДлинЧто, ДлинСтроки  : Целое;

    Тмп =""; Стр =""; Стр2 ="";
    ДлинЧто    = Длина(Что    );
    ДлинСтроки = Длина(Где    );
    Рез        = Поз  (Что,Где);
    Тмп        = Где;
      пока НЕ (Рез = 0) цикл
        Стр  = Тмп;
        Рез  = Поз(Что,Стр);
        ПозПовтора = Рез+ДлинЧто;
        Отсюда = ПодСтр(Стр,ПозПовтора,ДлинСтроки);
        если Рез = 1 тогда
            Стр2 = НаЧто +Отсюда;
        Иначе
            Стр2 = ПодСтр(Стр,1,Рез-1)+ НаЧто +Отсюда;
        конец;
        Тмп = Стр2;
        ИскатьЗдесь = ПодСтр(Тмп,ПозПовтора,ДлинСтроки);  --Определяем строку в которой нужно искать заменяемые символы
        Рез = Поз(Что,ИскатьЗдесь);                       --Она не содержит уже произведенную замену! Это важно!!!! Иначе Бескон. цикл!!!!
      конец;
  Результат = Тмп ;
конец;
--------------------------------------------------------------------------------
--Заменяем только ОДНО (один раз)!!!
функ ВСтрЗаменить(Что : Строка; НаЧто: Строка; Где : Строка): Строка;
 var Стр,Стр2,Стр3,Тмп : Строка;
 var Рез,
     ДлинЧто,ПозПовтора ,
     ДлинСтроки         : Целое;

      Тмп =""; Стр ="";  Стр2 ="";
      ДлинЧто    = Длина(Что  );
      ДлинСтроки = Длина(Где  );
      Рез        = Поз(Что,Где);
      ПозПовтора = Рез+ДлинЧто;
      Стр3 = ПодСтр(Где,ПозПовтора,ДлинСтроки);
      Тмп = Где;
        Если Рез = 0 Тогда
         Тмп = Где;
        Иначе
          Стр = Тмп;
          если Рез = 1 тогда
              Стр2 = НаЧто +Стр3;
          Иначе
              Стр2 = ПодСтр(Стр,1,Рез-1)+ НаЧто +Стр3;
          конец;
          Тмп = Стр2;
        конец;

  Результат = Тмп ;
конец;
--------------------------------------------------------------------------------
Функ СуществуетВОдномерномМассиве(Что : Строка; Перем Где [] : Вариант ):Логическое;
  var I : Целое;

      i = SearchInArray (Где , Что );
      if i=-1 then
         Возврат  Ложь;
      ELSE
        -- Трассировка("  "+Что+" - Найдено! Позиция - "+ВСтр(I) ); --Для отладки Функции
         Возврат  Истина;
      FI;

конец;
--------------------------------------------------------------------------------
Функ СтрокуВДатуТ9 (Стр : Строка; ФорматД : Строка ) : Дата ;
 Перем Стр1, Стр2, Стр3: Строка ;
 Перем ДатаФайла       : Дата   ;
     Если ФорматД = "ДДММГГГГ"  тогда
       Стр1 = ПодСтр(Стр,1,2);
       Стр2 = ПодСтр(Стр,3,2);
       Стр3 = ПодСтр(Стр,5,4);
       ДатаФайла = StringToDate(Стр1+"."+Стр2+"."+Стр3 ); -- ДД.ММ.ГГГГ
     ЕслиЖе ФорматД = "ГГГГММДД"  тогда
       Стр3 = ПодСтр(Стр,1,4);
       Стр2 = ПодСтр(Стр,5,2);
       Стр1 = ПодСтр(Стр,7,2);
       ДатаФайла = StringToDate(Стр1+"."+Стр2+"."+Стр3 ); -- ДД.ММ.ГГГГ
     ЕслиЖе ФорматД = "ММДДГГГГ"  тогда
       Стр1 = ПодСтр(Стр,1,2);
       Стр2 = ПодСтр(Стр,3,2);
       Стр3 = ПодСтр(Стр,5,4);
       ДатаФайла = StringToDate(Стр1+"."+Стр2+"."+Стр3 ); -- ДД.ММ.ГГГГ
     Иначе
       ДатаФайла = Сегодня ;  --Если не известный формат
     Илсе;
   Результат = ДатаФайла ;
конец;
--------------------------------------------------------------------------------
Функ ЯвляетсяЧислом (Стр : Вариант ) : Логическое ;
 Перем Стр1              : Строка ;
 Перем ДлинСтр,I     : Целое ;

   Если VarType(Стр ) = 3  Тогда    --Число
      Результат = Истина;
   ЕслиЖе VarType(Стр ) = 2  Тогда  --Целое
      Результат = Истина;
   ЕслиЖе VarType(Стр ) = 1  Тогда  --Строка
     ДлинСтр = Длина(Trim(Стр) );
     Для I = 1..ДлинСтр Цикл
       Стр1 = ПодСтр(Стр,I,1);
       if Стр1 in ['-','0','1','2','3','4','5','6','7','8','9',РазделительДробнойЧастиСистемный] then
         Результат = Истина;
       Иначе
         Результат = Ложь ;
         Прервать;
       end;
     Лкиц;
   Илсе;
  Возврат Результат ;
конец;
--------------------------------------------------------------------------------
--      Получить Строку типа - 4_3_5_8_8_6_5
--      из "brok_rpt_03425_20091001_20091031_163106_final"
Функ ШаблонИмениФайла (SS: Строка ): Строка ;
  var РазбиваемаяСтрока  :Строка;
  var Разделители        :Строка;
  var Стр1               :Строка;
  var Строки             :Строка[];
  Перем I,k      : Целое ;
    Стр1 = "" ;
    k    = 0  ;
    Строки = Nil ;            --Обнуляем Массив
    РазбиваемаяСтрока = SS;   --Строка(наш файл)
    Разделители = "_" ;       --Символ разделения
    РазбитьСтроку(РазбиваемаяСтрока,Разделители,Строки);
      Для I = 1..ДлинаМассива(Строки) Цикл
         k = Длина(Строки [I]) ;
         Если I = 1 Тогда
           Стр1 = ВСтр(k) ;
         Иначе
           Стр1 = Стр1+"_"+ВСтр(k) ;
         Илсе;
      Лкиц;
  Результат = Стр1;
Кнуф;
--------------------------------------------------------------------------------
inobject

end